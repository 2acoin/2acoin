image:
  - Visual Studio 2019

cache:
  - c:\users\appveyor\clcache
  - c:\local\boost_1_69_0

environment:
  BOOST_ROOT: C:\local\boost_1_69_0
  BOOST_LIBRARYDIR: C:\local\boost_1_69_0\lib64-msvc-14

init:
  - set PATH=c:\Python37;c:\Python37\Scripts;%PATH%
  - pip install clcache

before_build:
  - clcache -s

install:
  - ps: Write-Host "Checking for Boost 1.69.0 x64...";$boostdir  = Test-Path $Env:BOOST_ROOT;If ($boostdir -eq $False) {Write-Host "Downloading Boost 1.69.0 x64...";$exePath = "$Env:TEMP\boost_1_69_0-msvc-14.1-64.exe";(New-Object Net.WebClient).DownloadFile('https://bintray.com/boostorg/release/download_file?file_path=1.69.0%2Fbinaries%2Fboost_1_69_0-msvc-14.1-64.exe', $exePath);Write-Host "Installing Boost 1.69.0 x64...";cmd /c start /wait "$exePath" /verysilent;del $exePath};Write-Host "Boost 1.69.0 x64 installed!" -ForegroundColor Green

build_script:
  - md build
  - cd build
  - cmake -G "Visual Studio 16 2019" -A x64 .. -DARCH=default -DOPENSSL_ROOT_DIR=C:\OpenSSL-v111-Win64
  - MSBuild 2ACoin.sln /p:CLToolExe=clcache.exe /p:CLToolPath=c:\Python37\Scripts\ /p:Configuration=Release /m
  - src\Release\cryptotest.exe

after_build:
  - clcache -s
  - if not defined APPVEYOR_REPO_TAG_NAME (set APPVEYOR_REPO_TAG_NAME=%APPVEYOR_REPO_COMMIT%)
  - cd src\Release
  - mkdir 2ACoin-%APPVEYOR_REPO_TAG_NAME%
  - copy *.exe 2ACoin-%APPVEYOR_REPO_TAG_NAME%
  - copy ..\..\..\LICENSE 2ACoin-%APPVEYOR_REPO_TAG_NAME%
  - 7z a 2ACoin-%APPVEYOR_REPO_TAG_NAME%-windows.zip 2ACoin-%APPVEYOR_REPO_TAG_NAME%
  - copy 2ACoin-%APPVEYOR_REPO_TAG_NAME%-windows.zip ..\..\..\

artifacts:
  - path: 2ACoin-$(APPVEYOR_REPO_TAG_NAME)-windows.zip
    name: 2ACoinRelease

deploy:
  - provider: GitHub
    auth_token:
      secure: AOtonaRkm/3AeJ3y3TsadNYz9ksJPwaN/hNBkzDkYTsT0jYmeBz9mhznpIKpQIlr
    artifact: 2ACoinRelease
    draft: true
    prerelease: false
    on:
      appveyor_repo_name: 2acoin/2acoin
      appveyor_repo_tag: true

  - provider: S3
    access_key_id:
      secure: WBT2p+c/Z919ILd3OEY9oYNf5zDHrNNtn0RNhdEbXuxDmHMeLMzJrOsf93ZFBd1K2q1VkGMROWC1Xa+CX1ftG8xaog9dYBVpA6fTVRXmjX5yTxdz9F3Bf6Rg7oqG4I+D6ZsbFQoOwB8pFQV9WJSfqjYrQqSuB7go35AYRzwABNMYeA1XoqnktH29KI5/XymfEjBGY/vqfJvaZz4Z+spba8nu48cjQBBPFPzlv/BBGF2UGu69MHDU0ND0zaSoKubYt2U+JKY7zuBOAqF2MRdVyIgtEuX8BHRFFccynhmL2J+wwwz/2OM2JWZa1XbNGtKXuybnlpegjx1lKSjiLNQi8ovgDqKlP43AF2FqYOVRV9hBvQHqssi/EUoaJUubrGBA83jn50UtONr8mykwHGBXsp66+PNP8fXHO/T4j5v5PAULwIAtOAJA4aCCQbNaw7AmYPTH8gVRAlMFcNEA8NfgAKKnA6aKBAYpJN6lmz9bgmewkwT05rze6oTnjCv+T9RggOuYIm7rDe41tzPwk1EfLVmSdDPVRHwW0RDBmMt6L/WhMmWH7yNSGEPydGE+bles8vUSLPLN6YQSC0iSE8A0huAqzob/3x56XNh6+PDqMNvCx49Bz8D1zbgQn+s2yhm4r2N27f3Ui3dmjw4jIxapH7LothdH5s0g33p3R7r+1mU=
    secret_access_key:
      secure: Ada79+MpDjZrxUihka5u5381AQlBzAwTWQekxZ/WWDx9xxu7LgQuSDDmetk/Fjcnuqew4CyxuHmyUOjUb2QEwJaOorJlxJOhXyLQJUT8CnWXy6uvCNNn/NenBGqcJvK4w3k8wIqAk3UZxemO1d3xkVQCWRuvKn+AFjewVu1Db4miac33jwccejC6TJUmC02bIFP+CuJvn8cA3exiPMGzc3LeNxL0AapGlP2Vf/ECVCgEVcapVp5Zayr8go7axKkSuZqx9lBUOKkc9AIswFJboy2JL5HKJWCr1486ayWJAKSLS81Vi+vYZHtl6bUz1MKTSdLE6c5mcD+FjLjPpOzxQPW/ytZnBJ9WvFZzMFGHL+5v3T9SO5xAU+IngXjktbbziMJX7B7M3Z2TeXqiLgFEk1hymPWLetgjf/SMXhmcSITZb7n8RtLdLP4JDKwORsIX2oLJyC6dLndAmcYwC0JUkkIYp/btz/L/X+GRW/JXrFEuEchn7DkezWvRWj3p+j0GTKnvpduUxuQQ7ZlUYiqwocx5hsHpzRPbcxUaFt3EPP/pUErRgVE/XGntxMY623YFHjYNv1ToVxN0svQUNLJvCc11flinH2FP1kAVwrc1FxCkigdqBGTJM4z8/SQWpU0UaICEcMnfCcH8eOnHFLPViNnd5oLOaSm704fR0Glcjf4=
    bucket: olk-2acoin
    region: us-east-1
    set_public: true
    folder: 2acoin
    artifact: 2ACoinRelease
    on:
      appveyor_repo_name: 2acoin/2acoin
